## Makefile基础

-----

### 1.Makefile格式规则

```makefile
目标... : 文件依赖
	命令1
	命令2
```



### 2.Makefile变量

1. 赋值符 "="

   变量的真实值取决于它所引用的变量的最后一次有效值  

2. 赋值符 ":="

   赋值符 “:=” 不会使用后面定义的变量，只能使用前面已经定义好的  

3. 赋值符 "?="

   如果前面已经赋过值了，那么就使用前面赋的值  

4. 变量追加 "+="

   给前面已经定义好的变量添加一些字符串进去
   
   

### 3.Makefile模式规则

模式规则中，至少在规则的目标定定义中要包涵“%”，否则就是一般规则，目标中的“%”表示对文件名的匹配，“%”表示长度任意的非空字符串，比如“%.c”就是所有的以.c 结尾的文件，类似与通配符， a.%.c 就表示以 a.开头，以.c 结束的所有文件。

当“%”出现在目标中的时候，目标中“%”所代表的值决定了依赖中的“%”值，使用方法如下：

```makefile
%.o : %.c
	命令
```



### 4.Makefile自动化变量

| 自动化变量 | 描述                                                         |
| :--------: | :----------------------------------------------------------- |
|     $@     | 在模式规则中，如果有多个目标的话，“$@”表示匹配模 式中定义的目标集合 |
|     $^     | 所有依赖文件的集合，使用空格分开，<br />如果在依赖文件中有多个重复的文件， “$^”会去除重复的依赖文件，值保留一份。 |
|     $<     | 依赖文件集合中的第一个文件，如果依赖文件是以模式(即“%” )定义的，那么 “$<”就是符合模式的一系列的文件集合 |



### 5.Makefile伪目标

```makefile
.PHONY:clean
```

声明 clean 为伪目标以后不管当前目录下是否存在名为“clean”的文件，输入“make clean”的话规则后面的 rm 命令都会执行。  



### 6.Makefile函数使用

1. 函数 subst  

   ```makefile
   $(subst <from>,<to>,<text>)
   ```

   将字符串 <text> 中的 <from> 内容替换为 <to>，函数返回被替换以后的字符串  

   

2. 函数patsubst  

   ```makefile
   $(patsubst <pattern>,<replacement>,<text>)
   ```

   查找字符串<text>中的单词是否符合模式<pattern>，如果匹配就用<replacement>来替换掉  

   ```makefile
   $(patsubst %.c,%.o,a.c b.c c.c)
   ```

3. 函数dir

   ```makefile
   $(dir <names...>)
   ```

   从文件名序列<names>中提取出目录部分，返回值是文件名序列<names>的目录部分  

   

4. 函数notdir

   ```makefile
   $(notdir <names...>)
   ```

   从文件名序列<names>中提取出文件名非目录部分  

   

5. 函数foreach

   ```makefile
   $(foreach <var>, <list>,<text>)
   ```

   把参数<list>中的单词逐一取出来放到参数<var>中，然后再执行<text>所包含的表达式  

   ```makefile
   name := a b c d
   @echo $(foreach n,$(name),$(n).o)
   ```

6. 函数wildcard

   ```makefile
   $(wildcard PATTERN…)
   ```

   通配符“%”只能用在规则中，只有在规则中它才会展开，

   如果在变量定义和函数使用时，通配符不会自动展开，这个时候就要用到函数 wildcard，  

   ```makefile
   $(wildcard *.c)
   ```

   上面的代码是用来获取当前目录下所有的.c 文件，类似“%”。  

